<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Inductobot.MainPage"
             Title="UAS-WAND Control">

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">
        
        <!-- Connection Status Section -->
        <Frame Grid.Row="0"
               BackgroundColor="{AppThemeBinding Light=#F0F8FF, Dark=#1A1A2E}"
               BorderColor="Transparent"
               Padding="15"
               Margin="0,0,0,10">
                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                    <Ellipse x:Name="ConnectionStatusIndicator"
                           Grid.Column="0"
                           WidthRequest="16"
                           HeightRequest="16"
                           VerticalOptions="Center">
                        <Ellipse.Fill>
                            <SolidColorBrush Color="Red"/>
                        </Ellipse.Fill>
                    </Ellipse>
                    
                    <VerticalStackLayout Grid.Column="1" Spacing="2">
                        <Label x:Name="ConnectionStatusLabel" 
                             Text="Not Connected" 
                             FontSize="16" 
                             FontAttributes="Bold"/>
                        <Label x:Name="DeviceInfoLabel" 
                             Text="No device selected" 
                             FontSize="12" 
                             TextColor="Gray"/>
                    </VerticalStackLayout>
                    
                    <Button Text="Disconnect" 
                          x:Name="DisconnectButton"
                          Clicked="OnDisconnectClicked"
                          IsVisible="False"
                          Grid.Column="2"/>
                </Grid>
            </Frame>
        
        <!-- Control Panels -->
        <ScrollView Grid.Row="1" Margin="0,10">
            <VerticalStackLayout Spacing="20">
                
                <!-- Current WiFi Settings Display (always visible) -->
                <Frame x:Name="WifiSettingsDisplay"
                       BackgroundColor="{AppThemeBinding Light=#F0F8FF, Dark=#1A1A2E}"
                       BorderColor="{AppThemeBinding Light=#4A90E2, Dark=#4A90E2}"
                       Padding="15"
                       IsVisible="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="⚙️ UAS-WAND WiFi Settings" 
                             FontSize="18" 
                             FontAttributes="Bold"
                             HorizontalOptions="Center"/>
                        
                        <Label x:Name="WifiSettingsStatus"
                             Text="WiFi settings not retrieved - click 'WiFi Settings' button to load"
                             FontSize="12"
                             FontAttributes="Italic"
                             TextColor="Gray"
                             HorizontalOptions="Center"
                             Margin="0,0,0,10"/>
                        
                        <Grid x:Name="WifiSettingsContent"
                              ColumnDefinitions="Auto,*" 
                              RowDefinitions="Auto,Auto,Auto,Auto,Auto" 
                              ColumnSpacing="10" 
                              RowSpacing="5"
                              IsVisible="False">
                            <Label Grid.Column="0" Grid.Row="0" Text="SSID:" FontSize="14" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Grid.Row="0" x:Name="CurrentSsidLabel" FontSize="14" FontFamily="Monospace"/>
                            
                            <Label Grid.Column="0" Grid.Row="1" Text="Enabled:" FontSize="14" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Grid.Row="1" x:Name="WifiEnabledLabel" FontSize="14" FontFamily="Monospace"/>
                            
                            <Label Grid.Column="0" Grid.Row="2" Text="Channel:" FontSize="14" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Grid.Row="2" x:Name="WifiChannelLabel" FontSize="14" FontFamily="Monospace"/>
                            
                            <Label Grid.Column="0" Grid.Row="3" Text="IP Address:" FontSize="14" FontAttributes="Bold"/>
                            <Label Grid.Column="1" Grid.Row="3" x:Name="WifiIpAddressLabel" FontSize="14" FontFamily="Monospace"/>
                            
                            <Label Grid.Column="0" Grid.Row="4" Text="Password:" FontSize="14" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Grid Grid.Column="1" Grid.Row="4" ColumnDefinitions="*,Auto,20" ColumnSpacing="8" VerticalOptions="Center">
                                <Border Grid.Column="0" 
                                      BackgroundColor="Transparent"
                                      Stroke="Transparent"
                                      StrokeThickness="0"
                                      Padding="8,4"
                                      VerticalOptions="Center">
                                    <Label x:Name="WifiPasswordLabel" 
                                         FontSize="14" 
                                         FontFamily="Monospace" 
                                         Text="••••••••"
                                         VerticalOptions="Center"
                                         HorizontalOptions="Start"/>
                                </Border>
                                <Border Grid.Column="1"
                                      BackgroundColor="Transparent"
                                      Stroke="Gray"
                                      StrokeThickness="1"
                                      VerticalOptions="Center"
                                      Padding="0"
                                      Margin="0">
                                    <Button x:Name="PasswordVisibilityButton"
                                          Text="👀" 
                                          FontSize="16"
                                          Clicked="OnPasswordVisibilityToggled"
                                          BackgroundColor="Transparent"
                                          BorderColor="Transparent"
                                          BorderWidth="0"
                                          WidthRequest="32"
                                          HeightRequest="28"
                                          Padding="0"
                                          VerticalOptions="Center"
                                          HorizontalOptions="Center"/>
                                </Border>
                                <!-- Empty column for scroll bar clearance -->
                            </Grid>
                        </Grid>
                        
                        <!-- Security Warning (only visible when password is shown) -->
                        <Label x:Name="PasswordVisibilityWarning"
                             Text="🔒 Password is visible - ensure privacy"
                             FontSize="11"
                             TextColor="Orange"
                             FontAttributes="Italic"
                             HorizontalOptions="Center"
                             IsVisible="False"
                             Margin="0,5,0,0"/>
                        
                        <Button x:Name="RefreshWifiButton"
                              Text="↻ Refresh WiFi Settings"
                              Clicked="OnRefreshWifiSettingsClicked"
                              FontSize="12"
                              Padding="8,6"
                              HorizontalOptions="Center"
                              Margin="0,5,0,0"/>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Device Information Panel -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                       BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="Device Information" 
                             FontSize="20" 
                             FontAttributes="Bold"/>
                        
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="20" RowSpacing="10">
                            <Button Text="Device Info" 
                                  Clicked="OnGetDeviceInfoClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="0" Grid.Row="0"/>
                            
                            <Button Text="Keep Alive" 
                                  Clicked="OnKeepAliveClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="1" Grid.Row="0"/>
                            
                            <Button Text="WiFi Settings" 
                                  Clicked="OnGetWifiSettingsClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="0" Grid.Row="1"/>
                            
                            <Button Text="Sleep Device" 
                                  Clicked="OnSleepDeviceClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="1" Grid.Row="1"/>
                        </Grid>
                        
                        <Label x:Name="DeviceInfoText" 
                             FontFamily="Monospace" 
                             FontSize="12" 
                             TextColor="Gray" 
                             Text="Device information will appear here..."/>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Measurement Panel -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                       BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <!-- Scanning Status Header -->
                        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                            <Label Text="Measurements &amp; Scanning" 
                                 FontSize="20" 
                                 FontAttributes="Bold"
                                 VerticalOptions="Center"
                                 Grid.Column="0"/>
                            
                            <!-- Scanning Status Traffic Light -->
                            <StackLayout Orientation="Horizontal" 
                                       Spacing="5" 
                                       VerticalOptions="Center"
                                       Grid.Column="1">
                                <Label Text="Scan Status:" 
                                     FontSize="12" 
                                     FontAttributes="Bold" 
                                     VerticalOptions="Center"/>
                                <Ellipse x:Name="ScanningStatusIndicator"
                                       WidthRequest="14"
                                       HeightRequest="14"
                                       VerticalOptions="Center">
                                    <Ellipse.Fill>
                                        <SolidColorBrush Color="Gray"/>
                                    </Ellipse.Fill>
                                </Ellipse>
                                <Label x:Name="ScanningStatusLabel" 
                                     Text="Idle" 
                                     FontSize="12" 
                                     VerticalOptions="Center"/>
                            </StackLayout>
                        </Grid>
                        
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="20" RowSpacing="10">
                            <Button Text="Start Scan" 
                                  Clicked="OnStartScanClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="0" Grid.Row="0"/>
                            
                            <Button Text="Stop Scan" 
                                  Clicked="OnStopScanClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="1" Grid.Row="0"/>
                            
                            <Button Text="Measurement" 
                                  Clicked="OnGetMeasurementClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="0" Grid.Row="1"/>
                            
                            <Button Text="Live Reading" 
                                  Clicked="OnGetLiveReadingClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="1" Grid.Row="1"/>
                        </Grid>
                        
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Live Reading Parameters:" FontSize="14" FontAttributes="Bold"/>
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                                <Entry x:Name="StartIndexEntry" 
                                     Placeholder="Start Index" 
                                     Text="0" 
                                     Keyboard="Numeric"
                                     Grid.Column="0"/>
                                <Entry x:Name="NumPointsEntry" 
                                     Placeholder="Num Points" 
                                     Text="100" 
                                     Keyboard="Numeric"
                                     Grid.Column="1"/>
                            </Grid>
                        </VerticalStackLayout>
                        
                        <ScrollView HeightRequest="150">
                            <Label x:Name="MeasurementText" 
                                 FontFamily="Monospace" 
                                 FontSize="12" 
                                 TextColor="Gray" 
                                 Text="Measurement data will appear here..."/>
                        </ScrollView>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- WiFi Configuration Panel -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                       BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="WiFi Configuration" 
                             FontSize="20" 
                             FontAttributes="Bold"/>
                        
                        <!-- WiFi Configuration Controls -->
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="10" RowSpacing="10">
                            <Entry x:Name="SsidEntry" 
                                 Text="{Binding Ssid}"
                                 Placeholder="SSID" 
                                 Grid.Column="0" Grid.Row="0"/>
                            
                            <Entry x:Name="PasswordEntry" 
                                 Text="{Binding Password}"
                                 Placeholder="Password" 
                                 IsPassword="True"
                                 Grid.Column="1" Grid.Row="0"/>
                            
                            <Button Text="Set WiFi" 
                                  Clicked="OnSetWifiSettingsClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="0" Grid.Row="1"/>
                            
                            <Button Text="Restart WiFi" 
                                  Clicked="OnRestartWifiClicked"
                                  FontSize="14"
                                  Padding="10,8"
                                  Grid.Column="1" Grid.Row="1"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Status Bar -->
        <Frame Grid.Row="2" 
               BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#1A1A1A}"
               BorderColor="Transparent"
               Padding="10,5">
            <Label x:Name="StatusLabel" 
                 Text="Ready" 
                 FontSize="12"
                 VerticalOptions="Center"
                 HorizontalOptions="Center"/>
        </Frame>
    </Grid>

</ContentPage>
