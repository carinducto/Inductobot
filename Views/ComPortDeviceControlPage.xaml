<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Inductobot.Views.ComPortDeviceControlPage"
             Title="COM Port Device Control">
    
    <Grid RowDefinitions="*,Auto" Padding="20">
        
        <!-- Content Section -->
        <ScrollView Grid.Row="0" Margin="0,0,0,10">
            <VerticalStackLayout Spacing="20">
                
                <!-- Device Info Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B5E20}"
                       BorderColor="{AppThemeBinding Light=#4CAF50, Dark=#4CAF50}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="🔌 Connected USB Device" 
                               FontSize="20" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"/>
                        
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="15" RowSpacing="10">
                            <Label Grid.Column="0" Grid.Row="0" Text="COM Port:" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Grid.Row="0" x:Name="ComPortLabel" Text="Loading..." VerticalOptions="Center"/>
                            
                            <Label Grid.Column="0" Grid.Row="1" Text="Description:" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Grid.Row="1" x:Name="DeviceDescriptionLabel" Text="Loading..." VerticalOptions="Center"/>
                            
                            <Label Grid.Column="0" Grid.Row="2" Text="Status:" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Grid.Row="2" x:Name="ConnectionStatusLabel" Text="Connected" TextColor="Green" VerticalOptions="Center"/>
                            
                            <Label Grid.Column="0" Grid.Row="3" Text="API:" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Label Grid.Column="1" Grid.Row="3" Text="Serial COM Port" VerticalOptions="Center"/>
                        </Grid>
                        
                        <Button x:Name="DisconnectButton"
                                Text="Disconnect"
                                Clicked="OnDisconnectClicked"
                                BackgroundColor="#F44336"
                                TextColor="White"/>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Serial Device Operations Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                       BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="⚙️ Serial Device Operations" 
                               FontSize="18" 
                               FontAttributes="Bold"/>
                        
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowDefinitions="Auto,Auto,Auto" RowSpacing="15">
                            <!-- Read Configuration -->
                            <Button Text="Read Config"
                                    x:Name="ReadConfigButton"
                                    Clicked="OnReadConfigClicked"
                                    BackgroundColor="#2196F3"
                                    TextColor="White"
                                    Grid.Column="0" Grid.Row="0"/>
                            
                            <!-- Write Configuration -->
                            <Button Text="Write Config"
                                    x:Name="WriteConfigButton" 
                                    Clicked="OnWriteConfigClicked"
                                    BackgroundColor="#4CAF50"
                                    TextColor="White"
                                    Grid.Column="1" Grid.Row="0"/>
                            
                            <!-- Device Identification -->
                            <Button Text="Device ID"
                                    x:Name="DeviceIdButton"
                                    Clicked="OnGetDeviceIdClicked"
                                    BackgroundColor="#FF9800"
                                    TextColor="White"
                                    Grid.Column="0" Grid.Row="1"/>
                            
                            <!-- Reset Device -->
                            <Button Text="Reset Device"
                                    x:Name="ResetDeviceButton"
                                    Clicked="OnResetDeviceClicked"
                                    BackgroundColor="#607D8B"
                                    TextColor="White"
                                    Grid.Column="1" Grid.Row="1"/>
                            
                            <!-- Firmware Info -->
                            <Button Text="Firmware Info"
                                    x:Name="FirmwareInfoButton"
                                    Clicked="OnFirmwareInfoClicked"
                                    BackgroundColor="#9C27B0"
                                    TextColor="White"
                                    Grid.Column="0" Grid.Row="2"/>
                            
                            <!-- Custom Command -->
                            <Button Text="Send Command"
                                    x:Name="SendCommandButton"
                                    Clicked="OnSendCustomCommandClicked"
                                    BackgroundColor="#795548"
                                    TextColor="White"
                                    Grid.Column="1" Grid.Row="2"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Configuration Panel -->
                <Frame BackgroundColor="{AppThemeBinding Light=#F0F8FF, Dark=#1A1A2E}"
                       BorderColor="{AppThemeBinding Light=#4A90E2, Dark=#4A90E2}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="🔧 Device Configuration" 
                               FontSize="18" 
                               FontAttributes="Bold"/>
                        
                        <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="15" RowSpacing="10">
                            <Label Grid.Column="0" Grid.Row="0" Text="Device Name:" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" Grid.Row="0" x:Name="DeviceNameEntry" Placeholder="UAS-WAND-001"/>
                            
                            <Label Grid.Column="0" Grid.Row="1" Text="Sampling Rate:" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" Grid.Row="1" x:Name="SamplingRateEntry" Placeholder="1000" Keyboard="Numeric"/>
                            
                            <Label Grid.Column="0" Grid.Row="2" Text="Mode:" VerticalOptions="Center"/>
                            <Picker Grid.Column="1" Grid.Row="2" x:Name="ModePicker">
                                <Picker.Items>
                                    <x:String>Continuous</x:String>
                                    <x:String>Triggered</x:String>
                                    <x:String>Burst</x:String>
                                    <x:String>SingleShot</x:String>
                                </Picker.Items>
                            </Picker>
                            
                            <Label Grid.Column="0" Grid.Row="3" Text="Gain:" VerticalOptions="Center"/>
                            <Entry Grid.Column="1" Grid.Row="3" x:Name="GainEntry" Placeholder="1" Keyboard="Numeric"/>
                        </Grid>
                        
                        <Button Text="Apply Configuration"
                                x:Name="ApplyConfigButton"
                                Clicked="OnApplyConfigClicked"
                                BackgroundColor="#00BCD4"
                                TextColor="White"/>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Command Response Section -->
                <Frame BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#2A2A2A}"
                       BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                       Padding="15">
                    <VerticalStackLayout Spacing="15">
                        <Label Text="💬 Command Responses" 
                               FontSize="18" 
                               FontAttributes="Bold"/>
                        
                        <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1A1A1A}"
                               BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#404040}"
                               Padding="15"
                               HeightRequest="150">
                            <ScrollView x:Name="ResponseScrollView">
                                <Label x:Name="CommandResponseLabel" 
                                       Text="No commands sent yet. Use the buttons above to interact with the device."
                                       FontFamily="Consolas"
                                       FontSize="12"
                                       TextColor="Gray"/>
                            </ScrollView>
                        </Frame>
                        
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                            <Button Text="Clear Responses"
                                    x:Name="ClearResponsesButton"
                                    Clicked="OnClearResponsesClicked"
                                    BackgroundColor="#9E9E9E"
                                    TextColor="White"/>
                            
                            <Button Text="Export Log"
                                    x:Name="ExportLogButton"
                                    Clicked="OnExportLogClicked"
                                    BackgroundColor="#607D8B"
                                    TextColor="White"
                                    Grid.Column="1"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>
                
            </VerticalStackLayout>
        </ScrollView>
        
        <!-- Status Bar -->
        <Frame Grid.Row="1" 
               BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#1A1A1A}"
               BorderColor="Transparent"
               Padding="10,5">
            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10">
                <Label Text="🔌" FontSize="16" VerticalOptions="Center"/>
                <Label x:Name="StatusLabel" 
                     Text="Connected via USB - Serial API Active" 
                     FontSize="14"
                     VerticalOptions="Center"
                     Grid.Column="1"/>
                <Label x:Name="TimestampLabel" 
                     Text="" 
                     FontSize="12"
                     TextColor="Gray"
                     VerticalOptions="Center"
                     Grid.Column="2"/>
            </Grid>
        </Frame>
        
    </Grid>
</ContentPage>